#!/usr/bin/env ruby     
require "fileutils"
KIT = "devkit"
DP="dev-packages"
PULL_CMD="smart-pull"
CUR_WD = FileUtils.pwd

repo_paths = []

Dir.foreach DP do |dpkg|
  next if dpkg =~ /^\.\.?$/
  repo_paths << "#{DP}/#{dpkg}"
end
repo_paths << "~/.kit"
repo_paths << "."

repo_paths.map! { |path| File.expand_path path }

repo_paths.map { |p| 
  Thread.new(p) do |path|
    puts "Pulling #{File.basename path}"  
    out = `cd #{path} && git #{PULL_CMD}` 
    puts out
  end
}.each {|t| t.join }


FileUtils.cd CUR_WD

puts `#{KIT}`
